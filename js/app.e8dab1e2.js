(function(){"use strict";var e={6073:function(e,t,a){var n=a(9242),o=a(3396),s=a(4870);const l={class:"navbar navbar-expand-lg navbar-light bg-light"},r={class:"container-fluid"},c=(0,o._)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,o._)("span",{class:"navbar-toggler-icon"})],-1),i={class:"collapse navbar-collapse",id:"navbarNav"},u={class:"navbar-nav"},d={class:"nav-item"},v=(0,o.Uk)("Home"),p={class:"nav-item"},h=(0,o.Uk)("Tracker Map"),g={class:"nav-item"},b=(0,o.Uk)("Grafana"),m={class:"nav-item"},w=(0,o.Uk)("InfluxDB"),f=["disabled"],_={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},y=(0,o.Uk)(" Download App ");var k={__name:"App",setup(e){const t=(0,s.iH)(!1);async function a(){t.value=!0;try{let e=await fetch("http://bad-day.today:3000/file2/app/latest");if(200===e.status){let t=await e.json();console.log(t);let a=await fetch(t.link);const n=await a.blob(),o=document.createElement("a");o.href=window.URL.createObjectURL(n),o.setAttribute("download",`app-${t.version}.apk`),document.body.appendChild(o),o.click(),o.remove()}}catch(e){console.error(e)}t.value=!1}return(e,n)=>{const s=(0,o.up)("router-link"),k=(0,o.up)("RouterView");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("nav",l,[(0,o._)("div",r,[c,(0,o._)("div",i,[(0,o._)("ul",u,[(0,o._)("li",d,[(0,o.Wm)(s,{class:"nav-link active","aria-current":"page",to:"/"},{default:(0,o.w5)((()=>[v])),_:1})]),(0,o._)("li",p,[(0,o.Wm)(s,{class:"nav-link",to:"/Map"},{default:(0,o.w5)((()=>[h])),_:1})]),(0,o._)("li",g,[(0,o.Wm)(s,{class:"nav-link",to:"/Graphs"},{default:(0,o.w5)((()=>[b])),_:1})]),(0,o._)("li",m,[(0,o.Wm)(s,{class:"nav-link",to:"/InfluxDB"},{default:(0,o.w5)((()=>[w])),_:1})])])]),(0,o._)("button",{onClick:a,class:"btn btn-secondary pull-right",disabled:t.value},[t.value?((0,o.wg)(),(0,o.iD)("span",_)):(0,o.kq)("",!0),y],8,f)])]),(0,o.Wm)(k)],64)}}};const D=k;var x=D,T=a(2483),S=(a(7658),a(8675),a(3408),a(4590),a(7139));a(541);const C=e=>((0,o.dD)("data-v-1fae2a03"),e=e(),(0,o.Cn)(),e),H={class:"col-md-6 mb-4"},M={class:"card bg-dark text-white"},z={class:"card-body"},O={class:"row"},j={class:"col-4"},P={class:"col-4 ms-auto text-center"},B={class:"card-text"},U={class:"form-group"},A=["value"],W=C((()=>(0,o._)("input",{class:"form-control",type:"file",name:"firmware"},null,-1))),E={class:"row"},I={class:"col-4"},V=["disabled"],$={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},N={class:"col-1 ms-auto"},q=C((()=>(0,o._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-arrow-down-short",viewBox:"0 0 16 16"},[(0,o._)("path",{"fill-rule":"evenodd",d:"M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"})],-1))),F=[q],G={key:0,class:"row table-responsive",style:{"max-height":"200px"},id:"debug-table"},R={class:"table table-sm",style:{color:"white"}},Y=C((()=>(0,o._)("thead",{class:"thead-dark"},[(0,o._)("tr",null,[(0,o._)("th",{scope:"col"},"#"),(0,o._)("th",{scope:"col"},"Time"),(0,o._)("th",{scope:"col"},"Message")])],-1))),Q={scope:"row"};var L={__name:"DeviceBlock",props:{name:Object},emits:["debugChange"],setup(e,{expose:t,emit:a}){const n=e,l="http://bad-day.today:3000/ota/upload",r=(0,s.iH)(!1),c=(0,s.iH)("Upload"),i=(0,s.iH)("Idle"),u=(0,s.iH)("Disconnected"),d={color:"red"},v=(0,s.iH)(!1),p=(0,s.iH)(!0),h=(0,s.iH)([]);function g(e,t){let a=t.split("/");if("status"==a[1])switch(a[2]){case"connection":{console.log(`Received: ${t} -> ${e}`);let a=JSON.parse(e);m("true"==a.conn,a.version.split("_")[0])}break;case"ota":if("status"!=a[3])break;i.value="Updating: "+e+"%",100==e?(i.value="Update Finished",r.value=!1,c.value="Upload"):(r.value=!0,c.value="In Progress...");break;case"debug":{let t=a[3];if("startup"==t){let t=JSON.parse(e);h.value=[],console.log("Startup messages:"),t.messages.forEach(((e,t)=>{console.log(e),h.value.unshift({id:t+1,text:e,time:(new Date).toTimeString().split(" ")[0]})}))}else if("messages"==t){let t=e.toString();h.value.unshift({id:t.split(":")[0],text:t.replace(t.split(":")[0]+":",""),time:(new Date).toTimeString().split(" ")[0]})}else"enabled"==t&&(console.log("Got debug enabled: "+e),p.value=0!=e)}break}else a[1]}async function b(e){e.preventDefault();const t=e.currentTarget;console.log("Submitting"),r.value=!0,c.value="Sending...";try{const e=new FormData(t);let a=await fetch(l,{method:"POST",body:e});200==a.status&&(c.value="Sent"),a=await a.text(),console.log(a)}catch(a){console.error(a)}}function m(e,t){v.value=e,u.value=(e?"C":"Disc")+"onnected "+t,d.color=e?"green":"red"}function w(){a("debugChange",n.name.text,!p.value)}return(0,o.bv)((()=>{})),t({onMessage:g,setConn:m,device:n}),(e,t)=>{const a=(0,o.up)("RouterLink");return(0,o.wg)(),(0,o.iD)("div",H,[(0,o._)("div",M,[(0,o._)("div",z,[(0,o._)("div",O,[(0,o._)("div",j,[(0,o.Wm)(a,{class:"header__nav__link",to:"/Dashborad/"+n.name.text},{default:(0,o.w5)((()=>[(0,o.Uk)((0,S.zw)(n.name.text),1)])),_:1},8,["to"])]),(0,o._)("div",P,[(0,o._)("p",{class:"rounded-pill fs-6",style:(0,S.j5)({backgroundColor:d.color})},(0,S.zw)(u.value),5)])]),(0,o._)("p",B,"Device state: "+(0,S.zw)(i.value),1),(0,o._)("form",{onSubmit:b,id:"ota_form",method:"post",enctype:"multipart/form-data"},[(0,o._)("div",U,[(0,o._)("input",{type:"hidden",id:"dname",name:"device_id",value:n.name.text},null,8,A),W,(0,o._)("div",E,[(0,o._)("div",I,[(0,o._)("button",{type:"submit",class:"btn btn-primary",disabled:r.value},[r.value?((0,o.wg)(),(0,o.iD)("span",$)):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,S.zw)(c.value),1)],8,V)]),(0,o._)("div",N,[(0,o._)("button",{class:"btn",onClick:t[0]||(t[0]=e=>w()),type:"button"},F)])])])],32),p.value&&v.value?((0,o.wg)(),(0,o.iD)("div",G,[(0,o._)("table",R,[Y,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(h.value,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e.id},[(0,o._)("th",Q,(0,S.zw)(e.id),1),(0,o._)("td",null,(0,S.zw)(e.time),1),(0,o._)("td",null,(0,S.zw)(e.text),1)])))),128))])])])):(0,o.kq)("",!0)])])])}}},J=a(89);const K=(0,J.Z)(L,[["__scopeId","data-v-1fae2a03"]]);var Z=K,X=a(9999),ee=a.n(X);const te={class:"row mt-4"};var ae={__name:"HomePage",setup(e){const t=(0,s.iH)({show:!1,message:"",style:"alert-success"}),a={qos:1,retain:!0},l=`mqtt_${Math.random().toString(16).slice(3)}`;var r={host:"bad-day.today",port:8091,endpoint:"/",clean:!0,connectTimeout:4e3,reconnectPeriod:4e3,clientId:l,username:"web",password:"webui",rejectUnauthorized:!1};const c=(0,s.iH)([]);var i={connected:!1};function u(e,t){e.push(t.text+"/status/ota/status"),e.push(t.text+"/status/debug/startup"),e.push(t.text+"/status/debug/messages"),e.push(t.text+"/status/debug/enabled")}function d(e){return this.topic.split("/")[0]!=e.device.name.text||(e.onMessage(this.message,this.topic),!1)}function v(e,a){t.value.style=e,t.value.message=a,t.value.show=!0,setTimeout((()=>{t.value.show=!1}),1500)}function p(e,t){console.log(e+" -> "+t),i.publish(e+"/set/debug/enabled",new Uint8Array([t?1:0]),a,(e=>{e&&console.log("Publish error",e)}))}(0,o.bv)((()=>{const{host:e,port:t,endpoint:a,...n}=r,s=`ws://${e}:${t}${a}`;try{i=ee().connect(s,n),i.on("connect",(()=>{v("alert-success","Connected to MQTT server!"),console.log("Connection succeeded!");let e=[];e.push("+/status/connection"),h.value.forEach((t=>u(e,t))),i.subscribe(e,(()=>{console.log("Subscribed to topics")}))})),i.on("reconnect",(()=>{v("alert-warning","Reconnecting to MQTT server!")})),i.on("error",(e=>{console.log("Connection failed",e),v("alert-danger","MQTT Error: "+e)})),i.on("message",((e,t)=>{let a=c.value.every(d,{message:t,topic:e});if(a&&"status"==e.split("/")[1]&&"connection"==e.split("/")[2]){console.log("Adding new device "+e.split("/")[0]);let a={id:h.value.length,text:e.split("/")[0],conn:"Disconnected"};h.value.push(a);let n=[];u(n,a),i.subscribe(n,(()=>{console.log("Subscribed to new topics")})),(0,o.Y3)((function(){c.value.forEach(d,{message:t,topic:e})}))}})),i.on("close",(()=>{v("alert-danger","Connection lost to MQTT server!")}))}catch(l){console.log("mqtt.connect error",l)}}));const h=(0,s.iH)([{id:0,text:"PowerMeter-45BD9E7C",conn:"Disconnected"}]);return(e,a)=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(n.uT,{name:"fade"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("div",{class:(0,S.C_)(["alert ",t.value.style]),role:"alert"},(0,S.zw)(t.value.message),3),[[n.F8,t.value.show]])])),_:1}),(0,o._)("div",te,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(h.value,(e=>((0,o.wg)(),(0,o.j4)(Z,{onDebugChange:p,name:e,conn:e.conn,key:e.id,ref_for:!0,ref_key:"itemRefs",ref:c},null,8,["name","conn"])))),128))])],64))}};const ne=(0,J.Z)(ae,[["__scopeId","data-v-d998efe0"]]);var oe=ne;a(6294),a(741);const se=e=>((0,o.dD)("data-v-8f07292c"),e=e(),(0,o.Cn)(),e),le={class:"container"},re={class:"row"},ce={class:"col-12 ms-auto"},ie={class:"row"},ue={class:"col-4"},de=(0,o.Uk)("Mode: "),ve=(0,o.Uk)("RSSI: "),pe={class:"col-4"},he={class:"col-4"},ge={class:"row"},be={class:"col-6"},me={class:"col-6"},we={key:0,class:"row table-responsive mt-5",style:{"max-height":"500px"},id:"debug-table"},fe=se((()=>(0,o._)("h2",{style:{color:"white"}},"Debug Messages:",-1))),_e={class:"table table-sm",style:{color:"black"}},ye=se((()=>(0,o._)("thead",{class:"thead-dark"},[(0,o._)("tr",null,[(0,o._)("th",{scope:"col"},"#"),(0,o._)("th",{scope:"col"},"Time"),(0,o._)("th",{scope:"col"},"Message")])],-1))),ke={scope:"row"},De={style:{color:"white"}};var xe={__name:"DashboardPage",emits:["debugChange"],setup(e,{emit:t}){const a=(0,s.iH)({show:!1,message:"",style:"alert-success"}),l=(0,s.iH)((0,T.yj)().params.id),r=(0,s.iH)({connection:{text:"N/A",style_color:"red"}}),c=`mqtt_${Math.random().toString(16).slice(3)}`;var i={host:"bad-day.today",port:8091,endpoint:"/",clean:!0,connectTimeout:4e3,reconnectPeriod:4e3,clientId:c,username:"web",password:"webui",rejectUnauthorized:!1},u={connected:!1};const d=(0,s.iH)(!1),v=(0,s.iH)(!0),p=(0,s.iH)([]);function h(e,t){a.value.style=e,a.value.message=t,a.value.show=!0,setTimeout((()=>{a.value.show=!1}),1500)}(0,o.bv)((()=>{const{host:e,port:t,endpoint:a,...n}=i,o=`ws://${e}:${t}${a}`;try{u=ee().connect(o,n),u.on("connect",(()=>{h("alert-success","Connected to MQTT server!"),console.log("Connection succeeded!");let e=[];e.push(l.value+"/status/connection"),e.push(l.value+"/status/data/main"),e.push(l.value+"/status/debug/startup"),e.push(l.value+"/status/debug/messages"),e.push(l.value+"/status/debug/enabled"),u.subscribe(e,(()=>{console.log("Subscribed to topics")}))})),u.on("reconnect",(()=>{h("alert-warning","Reconnecting to MQTT server!")})),u.on("error",(e=>{console.log("Connection failed",e),h("alert-danger","MQTT Error: "+e)})),u.on("message",((e,t)=>{m(e,t)})),u.on("close",(()=>{h("alert-danger","Connection lost to MQTT server!")}))}catch(s){console.log("mqtt.connect error",s)}}));(0,s.iH)([["Date","SolarPower"]]);const g=(0,s.iH)({solarW:0,solarV:0,acOutW:0,acOutPercent:0,battV:0,battChargeA:0,battDischargeA:0,mode:"N/A",rssi:0,tempEnv:0,tempBat:0,date:"N/A"});function b(e){let t=e.split(" ");this.solarW=t[0],this.solarV=t[1],this.acOutW=t[2],this.acOutPercent=t[3],this.battV=t[4],this.battChargeA=t[5],this.battDischargeA=t[6],this.mode=_(t[7]),this.rssi=t[8],this.tempEnv=t[9],this.tempBat=t[10]}function m(e,t){if(e.split("/")[0]!=l.value)return;let a=e.split("/");if("status"==a[1])switch(a[2]){case"connection":{let e=JSON.parse(t);w("true"==e.conn,e.version.split("_")[0])}break;case"data":{let e=new b(String(t));g.value=e,g.value.date=f()}break;case"debug":{let e=a[3];if("startup"==e){let e=JSON.parse(t);p.value=[],console.log("Startup messages:"),e.messages.forEach(((e,t)=>{console.log(e),p.value.unshift({id:t+1,text:e,time:(new Date).toTimeString().split(" ")[0]})}))}else if("messages"==e){let e=t.toString();p.value.unshift({id:e.split(":")[0],text:e.replace(e.split(":")[0]+":",""),time:(new Date).toTimeString().split(" ")[0]})}else"enabled"==e&&(console.log("Got debug enabled: "+t),v.value=0!=t)}break}}function w(e,t){d.value=e,r.value.connection.text=(e?"C":"Disc")+"onnected "+t,r.value.connection.style_color=e?"green":"red"}function f(){let e=new Date,t=("0"+e.getDate()).slice(-2),a=("0"+(e.getMonth()+1)).slice(-2),n=e.getFullYear(),o=("0"+e.getHours()).slice(-2),s=("0"+e.getMinutes()).slice(-2),l=("0"+e.getSeconds()).slice(-2);return n+"-"+a+"-"+t+" "+o+":"+s+":"+l}function _(e){switch(e){case"P":return"Power On";case"S":return"Standby";case"Y":return"Bypass";case"L":return"Line";case"B":return"Battery";case"T":return"Battery Test";case"F":return"Fault";case"D":return"Shutdown";case"G":return"Grid";case"C":return"Charge";default:return"Undefined"}}return(e,t)=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(n.uT,{name:"fade"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("div",{class:(0,S.C_)(["alert ",a.value.style]),role:"alert"},(0,S.zw)(a.value.message),3),[[n.F8,a.value.show]])])),_:1}),(0,o._)("div",le,[(0,o._)("div",re,[(0,o._)("div",ce,[(0,o._)("h1",{style:(0,S.j5)({color:r.value.connection.style_color})},"Device Status: "+(0,S.zw)(r.value.connection.text),5)])]),(0,o._)("div",ie,[(0,o._)("div",ue,[(0,o._)("h2",null,"Date: "+(0,S.zw)(g.value.date),1),(0,o._)("h2",null,[de,(0,o._)("span",{style:(0,S.j5)({color:"Line"==g.value.mode?"red":"green"})},(0,S.zw)(g.value.mode),5)]),(0,o._)("span",null,[(0,o._)("h2",null,[ve,(0,o._)("span",{style:(0,S.j5)({color:g.value.rssi<-90?"red":"green"})},(0,S.zw)(g.value.rssi),5)])])]),(0,o._)("div",pe,[(0,o._)("h2",null,"Solar Power: "+(0,S.zw)(g.value.solarW)+"W",1),(0,o._)("h2",null,"Solar Voltage: "+(0,S.zw)(g.value.solarV)+"V",1),(0,o._)("h2",null,"AC Out Power: "+(0,S.zw)(g.value.acOutW)+"W",1)]),(0,o._)("div",he,[(0,o._)("h2",null,"Battery Voltage: "+(0,S.zw)(g.value.battV)+"V",1),(0,o._)("h2",null,"Battery Charge: "+(0,S.zw)(g.value.battChargeA)+"A",1),(0,o._)("h2",null,"Battery Discharge: "+(0,S.zw)(g.value.battDischargeA)+"A",1)])]),(0,o._)("div",ge,[(0,o._)("div",be,[(0,o._)("h2",null,"Enviroment Temperature: "+(0,S.zw)(g.value.tempEnv)+"℃",1)]),(0,o._)("div",me,[(0,o._)("h2",null,"Battery Temperature: "+(0,S.zw)(g.value.tempBat)+"℃",1)])]),v.value&&d.value?((0,o.wg)(),(0,o.iD)("div",we,[fe,(0,o._)("table",_e,[ye,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(p.value,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e.id},[(0,o._)("th",ke,(0,S.zw)(e.id),1),(0,o._)("td",null,(0,S.zw)(e.time),1),(0,o._)("td",De,(0,S.zw)(e.text),1)])))),128))])])])):(0,o.kq)("",!0)])],64))}};const Te=(0,J.Z)(xe,[["__scopeId","data-v-8f07292c"]]);var Se=Te;a(1827),a(2598),a(7793),a(4109),a(5291),a(7309),a(3292),a(9962),a(1508),a(2949),a(2205),a(8437);const Ce=[{path:"/",name:"Home",component:oe},{path:"/Dashborad/:id",name:"/PowerMeter",component:Se},{path:"/Map",name:"Tracker Map"},{path:"/Graphs",name:"Grafana"},{path:"/InfluxDB",name:"InfluxDB"}],He=(0,T.p7)({history:(0,T.r5)(),routes:Ce});He.beforeEach(((e,t,a)=>{"/Map"===e.path?window.location.href="http://bad-day.today:3002":"/Graphs"===e.path?window.location.href="http://bad-day.today:3001/d/Tvoo_jSVk/solar-power?orgId=1&refresh=10s&from=now%2Fd&to=now":"/InfluxDB"===e.path?window.location.href="http://bad-day.today:8086/orgs/4849ebbadb95a54a/dashboards-list":a()}));var Me=He;a(5654);(0,n.ri)(x).use(Me).mount("#app")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,n,o,s){if(!n){var l=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],s=e[u][2];for(var r=!0,c=0;c<n.length;c++)(!1&s||l>=s)&&Object.keys(a.O).every((function(e){return a.O[e](n[c])}))?n.splice(c--,1):(r=!1,s<l&&(l=s));if(r){e.splice(u--,1);var i=o();void 0!==i&&(t=i)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[n,o,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,s,l=n[0],r=n[1],c=n[2],i=0;if(l.some((function(t){return 0!==e[t]}))){for(o in r)a.o(r,o)&&(a.m[o]=r[o]);if(c)var u=c(a)}for(t&&t(n);i<l.length;i++)s=l[i],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(u)},n=self["webpackChunkbootstrap_vue"]=self["webpackChunkbootstrap_vue"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(6073)}));n=a.O(n)})();
//# sourceMappingURL=app.e8dab1e2.js.map